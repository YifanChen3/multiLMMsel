% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cv.R
\name{MORES.cv}
\alias{MORES.cv}
\title{Cross-validation for MORES}
\usage{
MORES.cv(
  Y,
  Z,
  X,
  lambda.path,
  tau.path,
  threshold = 0.01,
  folds = 5,
  id,
  gamma = 2,
  gamma.weight = 2,
  alpha = 1,
  sigmaB = NULL,
  sigmaE = NULL,
  beta = NULL,
  eta = NULL,
  max.iterB = 1000,
  tolB = 1e-04,
  bootstrap.iter = 30
)
}
\arguments{
\item{Y}{Response matrix of size \code{N x d}.}

\item{Z}{Random-effects design matrix of size \code{N x q}.}

\item{X}{Fixed-effects design matrix of size \code{N x p}.}

\item{lambda.path}{Numeric vector of candidate regularization parameters
for random effects selection.}

\item{tau.path}{Numeric vector of candidate regularization parameters
for fixed effects selection.}

\item{threshold}{Threshold on the diagonal of \code{Sigma_B} for defining
the active set.}

\item{folds}{Number of CV folds at the subject/cluster level.}

\item{id}{Subject/cluster index for each row (same length as \code{nrow(Y)}).}

\item{gamma}{Noise variance parameter used in the bootstrap-based beta
updating scheme.}

\item{gamma.weight}{Power used in the adaptive weights for the diagonal of
\code{Sigma_B}.}

\item{alpha}{One-standard-error parameter deciding how much standard
error to use to pick a more parsimonious lambda along the CV curve.}

\item{sigmaB, sigmaE, beta}{Optional "true" values used when evaluating F-norm
and F1 scores in simulation studies. If all are \code{NULL}, only estimates
are returned.}

\item{eta}{Step size for the update of \code{Sigma_B}.
If \code{NULL}, it is chosen theoretically from the largest eigenvalue of the Hessian.}

\item{max.iterB, tolB}{Parameters for the inner SigmaB update.}

\item{bootstrap.iter}{Number of bootstrap iterations used for beta estimation.}
}
\value{
If \code{sigmaB}, \code{sigmaE}, and \code{beta} are \code{NULL},
a list with:
\item{lambda.optimal}{Vector of selected lambda for each response.}
\item{tau.optimal}{Selected tau.}
\item{l.lambda}{Matrix of CV likelihoods over lambda.}
\item{l.tau}{Matrix of CV likelihoods over tau.}
\item{SigmaB}{Estimated random-effects covariance.}
\item{SigmaE}{Estimated error covariance.}
\item{beta}{Estimated fixed-effects matrix.}

Otherwise, additional F-norm and F1-score summaries are returned for
simulation evaluation.
}
\description{
Perform cross-validation over a sequence of \code{lambda}
values (per response) and \code{tau} values to select tuning parameters for
the MORES algorithm.
}
\details{
The function first selects the random-effects structure for each response,
then refits the covariance matrices and finally tunes the fixed-effects
penalty via cross-validation.
}
\examples{
\dontrun{
set.seed(1234)
d <- 3
q <- 5
dq <- d*q
p <- 10
m <- 50
ni <- 6
s <- 3
rho <- 0.5
M <- bdiag(toeplitz(rho^seq(0, s-1)),matrix(0,q-s,q-s))
R <- cbind(M,M,M)
sigmaB <- rbind(R,R,R)
rho <- 0.75
sigmaE <- toeplitz(rho^seq(0, d - 1))
id <- rep(1:m,each=ni)
m <- length(unique(id)) # Number of subjects (groups)
N <- length(id) # Total number of observations
epsilon <- mvrnorm(N,rep(0,d),sigmaE)
vecB <- mvrnorm(m,rep(0,dq),sigmaB)
B <- do.call(rbind,lapply(1:nrow(vecB), function(i) {
  matrix(vecB[i, ], nrow = q, ncol = d, byrow = FALSE)
}))
Z <- matrix(rnorm(N*q),nrow = N,ncol = q)
X <- matrix(rnorm(N*p),nrow = N,ncol = p)
beta <- matrix(c(1,-1,2,rep(0,7),-1,2,-1,rep(0,7),1,1,2,rep(0,7)),nrow = p,ncol = d)
Z_list <- lapply(split(seq_len(nrow(Z)), id),
                 function(idx) Z[idx, , drop = FALSE])
Z_long <- bdiag(lapply(Z_list, as.matrix))
Y <- X \%*\% beta + as.matrix(Z_long) \%*\% B + epsilon

lambda.max <- 5000
lambda.min <- lambda.max/100
length.out <- 30
lambdas <- exp(seq(log(lambda.max),log(lambda.min),length.out=length.out))

tau.max <- 1
tau.min <- tau.max/100
length.out <- 30
taus <- seq(tau.max,tau.min,length.out=length.out)

result.sim <- MORES.cv(
  Y,Z,X,lambdas,taus,id = id,
  sigmaB = sigmaB,sigmaE = sigmaE,beta=beta,alpha = 1
  )
}

}
